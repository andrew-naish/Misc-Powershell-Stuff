param ([Parameter(Mandatory=$true)][string]$path)

if ( !(Test-Path $path) ) { throw "invlaid path specified"}
else {$file = Get-ChildItem $path}

if ($file.Length -lt 4) {throw "file is too small > 4 bytes please"}

$cert = Get-ChildItem cert: -Recurse -CodeSigningCert
if (!$cert) { throw "no codesigning cert available"} 
else { $cert = $cert[0] }

$ts = "http://timestamp.comodoca.com/authenticode"
Get-ChildItem $path | Set-AuthenticodeSignature -Certificate $cert -TimestampServer "$ts"
# SIG # Begin signature block
# MIIOWwYJKoZIhvcNAQcCoIIOTDCCDkgCAQExCzAJBgUrDgMCGgUAMGkGCisGAQQB
# gjcCAQSgWzBZMDQGCisGAQQBgjcCAR4wJgIDAQAABBAfzDtgWUsITrck0sYpfvNR
# AgEAAgEAAgEAAgEAAgEAMCEwCQYFKw4DAhoFAAQUWC7GqGL2Y4yl75wm+Nt+tVH6
# FPugggoGMIIElDCCA3ygAwIBAgIRAJ/qyBGw8WJHpfwg2AUjrOYwDQYJKoZIhvcN
# AQEFBQAwgZUxCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJVVDEXMBUGA1UEBxMOU2Fs
# dCBMYWtlIENpdHkxHjAcBgNVBAoTFVRoZSBVU0VSVFJVU1QgTmV0d29yazEhMB8G
# A1UECxMYaHR0cDovL3d3dy51c2VydHJ1c3QuY29tMR0wGwYDVQQDExRVVE4tVVNF
# UkZpcnN0LU9iamVjdDAeFw0xNTA1MDUwMDAwMDBaFw0xNTEyMzEyMzU5NTlaMH4x
# CzAJBgNVBAYTAkdCMRswGQYDVQQIExJHcmVhdGVyIE1hbmNoZXN0ZXIxEDAOBgNV
# BAcTB1NhbGZvcmQxGjAYBgNVBAoTEUNPTU9ETyBDQSBMaW1pdGVkMSQwIgYDVQQD
# ExtDT01PRE8gVGltZSBTdGFtcGluZyBTaWduZXIwggEiMA0GCSqGSIb3DQEBAQUA
# A4IBDwAwggEKAoIBAQC8NaA2cCKBEcOyg7nTKMY2zSVrqXuyHPabUZzvNfTtCI5e
# OAj4dzwKQuDzcNyj18r1TAvP/yKcCn5o1gmiKoR7pp20qcEz4u8fF0jKOs1G5sWq
# d73jd5r6R1NAKFlDk/GkgervgLVPpwjOum68ynYMl2RZhiS7PYKQqFWxktOgpwWs
# n1MlCBBHmc2Y3mjltFB4o68BzFlDWOR2bn6sx+KeH0+wRy3IDKNJJ4B1jLsGkWUP
# kJv0utGByFxq7BTpJQm/Ixb0lUZAQCG7g5b9hh96yA0QjqL4GQdYf5+9NwJg8qTp
# nUQ/MAXkp3CZUZroF/FVyrJhiWVGp2ryWEZ+qqAHAgMBAAGjgfQwgfEwHwYDVR0j
# BBgwFoAU2u1kdBScFDyr3ZmpvVsoTYs8ydgwHQYDVR0OBBYEFC4tsApEStOHwAIH
# zpd9UGIg/Q+DMA4GA1UdDwEB/wQEAwIGwDAMBgNVHRMBAf8EAjAAMBYGA1UdJQEB
# /wQMMAoGCCsGAQUFBwMIMEIGA1UdHwQ7MDkwN6A1oDOGMWh0dHA6Ly9jcmwudXNl
# cnRydXN0LmNvbS9VVE4tVVNFUkZpcnN0LU9iamVjdC5jcmwwNQYIKwYBBQUHAQEE
# KTAnMCUGCCsGAQUFBzABhhlodHRwOi8vb2NzcC51c2VydHJ1c3QuY29tMA0GCSqG
# SIb3DQEBBQUAA4IBAQANu61gERu18A3M5kg6ej4OM9wcuerWIP6jTdDMdk7oGNh5
# 39NPmkJkI4opcoo6bGamPDoXqHBFZcZzw9DOiVT7rGkPWLAZy4affrl+61GSv5vd
# 69Fl8CV7iHzevaXItRRRvMCBMIqFOHvmef5nVZOH/k/ojQ7t83KStcKJgG3RWeMd
# DeqxOO4DnQAZpashm3nDzMI+aH69yU1pTbRkUfuyKHTiU4nOnfqt4tvOq3t+BkR0
# /QqjybenMM1J0pJk8SKmuChFdHnpp847M/mDUJR9aMAdScdgeHo8ZCbVvvoKbeQe
# 4QlTj6nFI6zHnWFCIfAsFnFJOxCvLG8a5jHxFP1sMIIFajCCBFKgAwIBAgIKYMDS
# CAAAAAABLDANBgkqhkiG9w0BAQUFADBIMRUwEwYKCZImiZPyLGQBGRYFbG9jYWwx
# FjAUBgoJkiaJk/IsZAEZFgZTaXBjb20xFzAVBgNVBAMTDlNpcGNvbS1DT1JQLUNB
# MB4XDTE1MTAxNjExMDExN1oXDTE2MTAxNTExMDExN1owgZMxFTATBgoJkiaJk/Is
# ZAEZFgVsb2NhbDEWMBQGCgmSJomT8ixkARkWBlNpcGNvbTEYMBYGA1UECwwPXyBT
# dHJ1Y3R1cmUgMi4wMQ4wDAYDVQQLEwVVc2VyczEhMB8GA1UECxMYQXBwbGljYXRp
# b25zIEVuZ2luZWVyaW5nMRUwEwYDVQQDEwxBbmRyZXcgTmFpc2gwgZ8wDQYJKoZI
# hvcNAQEBBQADgY0AMIGJAoGBANpX0upJQezV+vov/039DrFGSOA/XB6cKVKOnA4C
# hjb2okXPykoPhzsviqWWBDuyDq4lyjSLCwL9ER/v3OXWrEA6GUh3g8leTnOD8P7p
# ms6dXX7fv0oToOGLeX2lW7QmMy+AvOgNRKB9ZdSvxDZ1sPODJOYpBX8WHQ2CXxNC
# FzPXAgMBAAGjggKMMIICiDAlBgkrBgEEAYI3FAIEGB4WAEMAbwBkAGUAUwBpAGcA
# bgBpAG4AZzATBgNVHSUEDDAKBggrBgEFBQcDAzALBgNVHQ8EBAMCB4AwHQYDVR0O
# BBYEFFuvbK0hWDe0hgNn5K9FuYcpEXI/MB8GA1UdIwQYMBaAFPFUSjaMEexd9LkU
# P4oXI7OFdAH5MIIBAwYDVR0fBIH7MIH4MIH1oIHyoIHvhoG6bGRhcDovLy9DTj1T
# aXBjb20tQ09SUC1DQSxDTj1VSzNBRDEtQ09SUCxDTj1DRFAsQ049UHVibGljJTIw
# S2V5JTIwU2VydmljZXMsQ049U2VydmljZXMsQ049Q29uZmlndXJhdGlvbixEQz1T
# aXBjb20sREM9bG9jYWw/Y2VydGlmaWNhdGVSZXZvY2F0aW9uTGlzdD9iYXNlP29i
# amVjdENsYXNzPWNSTERpc3RyaWJ1dGlvblBvaW50hjBodHRwOi8vY3JsLnNpcGNv
# bS5sb2NhbC9jcmxkcC9TaXBjb20tQ09SUC1DQS5jcmwwgcEGCCsGAQUFBwEBBIG0
# MIGxMIGuBggrBgEFBQcwAoaBoWxkYXA6Ly8vQ049U2lwY29tLUNPUlAtQ0EsQ049
# QUlBLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNv
# bmZpZ3VyYXRpb24sREM9U2lwY29tLERDPWxvY2FsP2NBQ2VydGlmaWNhdGU/YmFz
# ZT9vYmplY3RDbGFzcz1jZXJ0aWZpY2F0aW9uQXV0aG9yaXR5MDIGA1UdEQQrMCmg
# JwYKKwYBBAGCNxQCA6AZDBdhbmRyZXcubmFpc2hAc2lwY29tLmNvbTANBgkqhkiG
# 9w0BAQUFAAOCAQEArIRslS9BsuV0T0wWwRziy7GcqIvueLPosnAq/D9TftopQNRx
# XVGl0r+X/eiIltqrtlrNINpownBAhXclxx0jUy07da2YNeNcymRvJcc1MXZ1rXTe
# AS4oRUQcF0MEWjxULJ3MrUJf7gdUQPB8uBKAalbRa5ix8iqsZfr/gDe3WosD4I6J
# Hhrsfs2kqcwU+EDhilAunw1OE/dciWbzwPbtyhpG+FoZl3lMSl+TancSfT8Ur2Et
# IdyiFJE9iPaj8yxWLUh/f3/4YTd49ugbCVL/SCCjOfCbj1UJtfwYj5RWC20qp9o0
# 95lzrV5iS+ocjPYYtpQ2H8vZDJU3D1iOd/q89DGCA78wggO7AgEBMFYwSDEVMBMG
# CgmSJomT8ixkARkWBWxvY2FsMRYwFAYKCZImiZPyLGQBGRYGU2lwY29tMRcwFQYD
# VQQDEw5TaXBjb20tQ09SUC1DQQIKYMDSCAAAAAABLDAJBgUrDgMCGgUAoHgwGAYK
# KwYBBAGCNwIBDDEKMAigAoAAoQKAADAZBgkqhkiG9w0BCQMxDAYKKwYBBAGCNwIB
# BDAcBgorBgEEAYI3AgELMQ4wDAYKKwYBBAGCNwIBFTAjBgkqhkiG9w0BCQQxFgQU
# D+GhipwJ9yjLtPX5I4b7rt4BfvcwDQYJKoZIhvcNAQEBBQAEgYCgefiTSQbp3Dz2
# OC0mM4hCKjsuMrozMp1RjCopshdvQrX0RUKOS5t8TUAVCASLW7qpc/x2MzlsYcl3
# SpNCR/oYw66EKIccc+jWHJwPb0dgXNTYMIXQXB69mQ/HNWhpmQystgESG0kE848I
# OpkyXiIIrloQRuqqw9OpiZ8L9KJLhKGCAkUwggJBBgkqhkiG9w0BCQYxggIyMIIC
# LgIBADCBqzCBlTELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAlVUMRcwFQYDVQQHEw5T
# YWx0IExha2UgQ2l0eTEeMBwGA1UEChMVVGhlIFVTRVJUUlVTVCBOZXR3b3JrMSEw
# HwYDVQQLExhodHRwOi8vd3d3LnVzZXJ0cnVzdC5jb20xHTAbBgNVBAMTFFVUTi1V
# U0VSRmlyc3QtT2JqZWN0AhEAn+rIEbDxYkel/CDYBSOs5jAJBgUrDgMCGgUAoF0w
# GAYJKoZIhvcNAQkDMQsGCSqGSIb3DQEHATAcBgkqhkiG9w0BCQUxDxcNMTUxMTAz
# MTEyNzI0WjAjBgkqhkiG9w0BCQQxFgQU63ooi9V88Mahh+Cd8VkEeLschGIwDQYJ
# KoZIhvcNAQEBBQAEggEAiSphpbuD1Kv5HY2tJeLGGdeWSv0gIHthty6kdZofCJ09
# 5zKbq6RSAtZThEPBFuCTd3KnBAVNdKOYIUBAJW4KJKKxiC8p9lmBVkUxo98oNrQX
# dPceqCVqA6w0p6HcJ3Gu4hgVCdx5OErwnAnOLxX9kfR7yYLde0fLtE4wvfitqmx7
# MT2FamKnLzi/ijZpSjD0+twMcGfxJogt/s7U6w59QqnK/d8ntf/pefJ941XBb7Da
# 8cfFD1wa7Gj+MbqorOQx2ZnjyZ7pmzzVqzYFny3Qd7JOKfv/ch/lDXArNIM7m4Et
# 3L+YFqK4ix3bEJgmhtyCFVuNjXCxN4klKndlvJvR/g==
# SIG # End signature block
